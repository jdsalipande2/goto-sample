<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Order System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Food Order System</h1>
    <div id="categories" class="categories-container"></div>
    <div id="menu-items" class="menu-container"></div>

    <script type="module">
        // Import the Supabase client
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

        // Initialize the Supabase client
        const supabaseUrl = "https://imsoflqfoidojyxfmtth.supabase.co"; // Your Supabase URL
        const supabaseKey = "YOUR_SUPABASE_KEY"; // Your Supabase Key (replace with the real key)
        const supabase = createClient(supabaseUrl, supabaseKey); // Create the Supabase client

        // Fetch categories from the 'category' table
        async function fetchCategories() {
            const { data: categories, error } = await supabase.from("category").select("*");
            console.log("Fetched Categories:", categories); // Debug log to check the fetched data

            if (error) {
                console.error("Error fetching categories:", error);
                return;
            }

            // Display categories if data is successfully fetched
            if (categories && categories.length > 0) {
                displayCategories(categories);
            } else {
                console.log("No categories found.");
            }
        }

        // Display categories in the HTML
        function displayCategories(categories) {
            const categoriesContainer = document.getElementById("categories");
            categoriesContainer.innerHTML = ""; // Clear the container before displaying new data

            categories.forEach(category => {
                let categoryElement = document.createElement("div");
                categoryElement.classList.add("category");
                categoryElement.innerHTML = `
                    <img src="${category.category_image}" alt="${category.category_name}" class="category-image">
                    <p>${category.category_name}</p>
                `;
                // Add event listener to fetch menu items when a category is clicked
                categoryElement.addEventListener("click", () => fetchMenuItems(category.category_id));
                categoriesContainer.appendChild(categoryElement);
            });
        }

        // Fetch menu items based on the category selected
        async function fetchMenuItems(categoryId) {
            const { data: menuItems, error } = await supabase
                .from("menu")
                .select("*")
                .eq("category_id", categoryId)
                .eq("menu_availability", "yes"); // Ensure only available menu items are fetched

            console.log("Fetched Menu Items:", menuItems); // Debug log to check fetched menu items

            if (error) {
                console.error("Error fetching menu items:", error);
                return;
            }

            // Display menu items if data is successfully fetched
            if (menuItems && menuItems.length > 0) {
                displayMenuItems(menuItems);
            } else {
                console.log("No menu items found for this category.");
            }
        }

        // Display menu items in the HTML
        function displayMenuItems(menuItems) {
            const menuContainer = document.getElementById("menu-items");
            menuContainer.innerHTML = ""; // Clear the container before displaying new data

            menuItems.forEach(menu => {
                let menuElement = document.createElement("div");
                menuElement.classList.add("menu-item");
                menuElement.innerHTML = `
                    <img src="${menu.menu_image}" alt="${menu.menu_name}" class="menu-image">
                    <h3>${menu.menu_name}</h3>
                    <p>${menu.menu_description}</p>
                    <p>Price: $${menu.menu_price}</p>
                    <button class="add-to-cart" data-id="${menu.menu_id}">Add to Cart</button>
                `;
                menuContainer.appendChild(menuElement);
            });

            // Add event listeners for the "Add to Cart" buttons
            document.querySelectorAll(".add-to-cart").forEach(button => {
                button.addEventListener("click", (e) => {
                    const menuId = e.target.getAttribute("data-id");
                    addToCart(menuId); // Placeholder function to handle the add-to-cart action
                });
            });
        }

        // Function to handle the "Add to Cart" action
        function addToCart(menuId) {
            console.log(`ðŸ›’ Item ${menuId} added to cart!`);
            // You can extend this function to manage the cart or store the cart items
        }

        // Fetch categories when the page loads
        fetchCategories();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Order System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Food Order System</h1>
    <div id="categories" class="categories-container"></div>
    <div id="menu-items" class="menu-container"></div>

    <script type="module">
        // Correctly importing the supabase-js client from the CDN
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

        // Supabase URL and API Key
        const supabaseUrl = "https://imsoflqfoidojyxfmtth.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imltc29mbHFmb2lkb2p5eGZtdHRoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk1MjAzNTIsImV4cCI6MjA1NTA5NjM1Mn0.CIp76CD--eg-1p2YKZ3VAxDqbz4ByakcqI_e-Z7D48Q"; // Use your actual key here
        const supabase = createClient(supabaseUrl, supabaseKey);

        console.log("âœ… Supabase Initialized", supabase);

        // Fetch categories
        async function fetchCategories() {
            const { data: categories, error } = await supabase.from("category").select("*");
            if (error) {
                console.error("Error fetching categories:", error);
                return;
            }
            displayCategories(categories);
        }

        // Display categories on the page
        function displayCategories(categories) {
            const categoriesContainer = document.getElementById("categories");
            categoriesContainer.innerHTML = "";
            categories.forEach(category => {
                let categoryElement = document.createElement("div");
                categoryElement.classList.add("category");
                categoryElement.innerHTML = `
                    <img src="${category.category_image}" alt="${category.category_name}">
                    <p>${category.category_name}</p>
                `;
                categoryElement.addEventListener("click", () => fetchMenuItems(category.category_id));
                categoriesContainer.appendChild(categoryElement);
            });
        }

        // Fetch menu items based on the selected category
        async function fetchMenuItems(categoryId) {
            const { data: menuItems, error } = await supabase
                .from("menu")
                .select("*")
                .eq("category_id", categoryId)
                .eq("menu_availability", "yes");

            if (error) {
                console.error("Error fetching menu items:", error);
                return;
            }
            displayMenuItems(menuItems);
        }

        // Display menu items on the page
        function displayMenuItems(menuItems) {
            const menuContainer = document.getElementById("menu-items");
            menuContainer.innerHTML = "";
            menuItems.forEach(menu => {
                let menuElement = document.createElement("div");
                menuElement.classList.add("menu-item");
                menuElement.innerHTML = `
                    <img src="${menu.menu_image}" alt="${menu.menu_name}">
                    <h3>${menu.menu_name}</h3>
                    <p>${menu.menu_description}</p>
                    <p>Price: $${menu.menu_price}</p>
                    <button class="add-to-cart" data-id="${menu.menu_id}">Add to Cart</button>
                `;
                menuContainer.appendChild(menuElement);
            });

            // Handle add-to-cart button clicks
            document.querySelectorAll(".add-to-cart").forEach(button => {
                button.addEventListener("click", (e) => {
                    const menuId = e.target.getAttribute("data-id");
                    addToCart(menuId);
                });
            });
        }

        // Log the addition of menu items to the cart
        function addToCart(menuId) {
            console.log(`ðŸ›’ Item ${menuId} added to cart!`);
        }

        // Call the function to fetch categories when the page loads
        fetchCategories();
    </script>
</body>
</html>
